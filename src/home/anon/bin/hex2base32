#!/bin/bash -e

# http://tools.ietf.org/html/rfc3548
# http://en.wikipedia.org/wiki/Base32

if [ $# != 1 ]; then
    echo "$0 <hex>"
    exit 1
fi

hex="$1"
len=${#hex}

if [ -z "${hex/*[^0-9a-fA-F]*/}" ]; then
    echo "Non-hexadecimal characters detected"
    exit 1
fi

if [ $[${len} % 5] != 0  -o  ${len} = 0 ]; then
    echo "Length must be a positive multiple of 5"
    exit 1
fi

hex=$(echo ${hex} | tr '[:upper:]' '[:lower:]')

ind=0
while [ ${ind} -lt ${len} ]; do
    sum=$[ 0x${hex:${ind}:5} ]

    inq=0
    rep=
    while [ ${inq} -lt 4 ]; do
        rem=$[ sum % 32 ]
        sum=$[ sum / 32 ]

        if [ ${rem} -ge 26 ]; then
            rem=$[ ${rem} - 26 + 2 - 97 + 48 ]
        fi

        rep=$(printf \\$(printf '%03o' $[97 + ${rem}]))${rep}

        let inq=inq+1
    done

    echo -n ${rep}

    let ind=ind+5
done

echo
